<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GLEN-WEATHER</title>
  <style>
    :root{
      --bg:#eef2f7; --card:#ffffff; --accent:#1e90ff;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{margin:0;background:var(--bg);color:#1a202c;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px;}
    .app{width:100%;max-width:900px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{margin:0;font-size:1.25rem}
    .controls{display:flex;gap:8px;align-items:center}
    input[type="search"]{padding:10px;border-radius:10px;border:1px solid #d1d5db;width:240px}
    button{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(15,23,42,.08)}
    .main{display:grid;grid-template-columns:1fr 320px;gap:14px}
    .current{padding:18px}
    .city{font-size:1.1rem;font-weight:600}
    .temp{font-size:3rem;font-weight:700;margin:6px 0}
    .meta{display:flex;gap:10px;flex-wrap:wrap}
    .meta small{background:#f1f5f9;padding:6px 8px;border-radius:8px}
    .icon{display:flex;align-items:center;gap:10px}
    .forecast{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .day{min-width:110px;flex:1;background:#fbfdff;padding:10px;border-radius:10px;text-align:center}
    .day .dname{font-weight:600;margin-bottom:6px}
    .error{color:#b91c1c;margin-top:8px}
    footer{margin-top:12px;font-size:12px;color:#475569}
    /* weather backgrounds */
    .bg-clear{background: linear-gradient(180deg, #aee1ff 0%, #e6f7ff 100%);}
    .bg-clouds{background: linear-gradient(180deg,#e9eef6 0%,#f6f8fb 100%);}
    .bg-rain{background: linear-gradient(180deg,#dbeaf7 0%,#e9f4ff 100%);}
    .bg-snow{background: linear-gradient(180deg,#f3f7fb 0%,#ffffff 100%);}
  </style>
</head>
<body>
  <div class="app card" id="appRoot">
    <header>
      <h1> Dashboard ☁️</h1>
      <div class="controls">
        <input id="searchInput" type="search" placeholder="Search city (e.g. Nairobi)" />
        <button id="searchBtn">Search</button>
        <button id="locBtn" title="Use my location">Use my location</button>
      </div>
    </header>

    <div class="main">
      <div class="card current" id="currentCard">
        <div class="city" id="cityName">—</div>
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
          <div>
            <div class="temp" id="temp">--°C</div>
            <div id="desc" style="text-transform:capitalize;color:#334155">—</div>
            <div class="meta" id="meta">
              <small id="feels">Feels: --°C</small>
              <small id="humidity">Humidity: --%</small>
              <small id="wind">Wind: -- m/s</small>
            </div>
          </div>
          <div class="icon">
            <img id="wicon" src="" alt="" width="110" height="110" style="image-rendering:pixelated"/>
          </div>
        </div>

        <div class="forecast" id="forecast"></div>
        <div class="error" id="errorMsg" style="display:none"></div>
      </div>

      <div class="card" style="padding:18px">
        <h3>Quick Info</h3>
        <p>Powered by OpenWeatherMap API. Replace the API key in the script with your own key from your OpenWeatherMap account.</p>
        <ul>
          <li>Current weather endpoint: <code>/data/2.5/weather</code></li>
          <li>Forecast endpoint: <code>/data/2.5/forecast</code> (3-hour steps; we pick one entry per day)</li>
        </ul>
        <footer>Tip: Press <strong>Use my location</strong> to auto-fill your city (asks browser permission).</footer>
      </div>
    </div>
  </div>

  <script>
  // =============== CONFIG ===============
  const API_KEY = 'c29b827f438416510d939a66da2d9c25'; // <-- replace with your OpenWeatherMap API key
  const CURRENT_URL = 'https://api.openweathermap.org/data/2.5/weather';
  const FORECAST_URL = 'https://api.openweathermap.org/data/2.5/forecast';
  const ICON_URL = (code) => `https://openweathermap.org/img/wn/${code}@2x.png`;

  // ====== DOM ======
  const qInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  const locBtn = document.getElementById('locBtn');
  const cityName = document.getElementById('cityName');
  const tempEl = document.getElementById('temp');
  const descEl = document.getElementById('desc');
  const feelsEl = document.getElementById('feels');
  const humidityEl = document.getElementById('humidity');
  const windEl = document.getElementById('wind');
  const wicon = document.getElementById('wicon');
  const forecastEl = document.getElementById('forecast');
  const errorMsg = document.getElementById('errorMsg');
  const appRoot = document.getElementById('appRoot');

  // ====== helpers ======
  function showError(msg){
    errorMsg.style.display='block';
    errorMsg.textContent = msg;
  }
  function clearError(){
    errorMsg.style.display='none';
    errorMsg.textContent = '';
  }

  function setBackgroundByWeather(main){
    appRoot.classList.remove('bg-clear','bg-clouds','bg-rain','bg-snow');
    if(!main) return;
    main = main.toLowerCase();
    if(main.includes('clear')) appRoot.classList.add('bg-clear');
    else if(main.includes('cloud')) appRoot.classList.add('bg-clouds');
    else if(main.includes('rain') || main.includes('drizzle') || main.includes('thunder')) appRoot.classList.add('bg-rain');
    else if(main.includes('snow')) appRoot.classList.add('bg-snow');
  }

  // pick one forecast entry per day (closest to 12:00)
  function buildDailyForecast(list){
    // group entries by date (YYYY-MM-DD)
    const groups = {};
    for(const item of list){
      const dt = new Date(item.dt * 1000);
      const dayKey = dt.toISOString().slice(0,10);
      if(!groups[dayKey]) groups[dayKey]=[];
      groups[dayKey].push(item);
    }
    const daily = [];
    for(const day of Object.keys(groups)){
      // pick entry closest to 12:00
      const entries = groups[day];
      let chosen = entries.reduce((a,b)=>{
        const at = Math.abs(new Date(a.dt*1000).getHours() - 12);
        const bt = Math.abs(new Date(b.dt*1000).getHours() - 12);
        return at <= bt ? a : b;
      }, entries[0]);
      daily.push(chosen);
    }
    return daily.slice(0,5); // first 5 days
  }

  async function fetchWeatherByCity(city){
    clearError();
    try{
      const curRes = await fetch(`${CURRENT_URL}?q=${encodeURIComponent(city)}&units=metric&appid=${API_KEY}`);
      if(!curRes.ok) throw new Error('City not found');
      const cur = await curRes.json();
      const fcRes = await fetch(`${FORECAST_URL}?q=${encodeURIComponent(city)}&units=metric&appid=${API_KEY}`);
      if(!fcRes.ok) throw new Error('Forecast not available');
      const fc = await fcRes.json();
      renderWeather(cur, fc);
    } catch(err){
      showError('Could not load weather: ' + (err.message || err));
    }
  }

  async function fetchWeatherByCoords(lat, lon){
    clearError();
    try{
      const curRes = await fetch(`${CURRENT_URL}?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`);
      if(!curRes.ok) throw new Error('Location weather not found');
      const cur = await curRes.json();
      const fcRes = await fetch(`${FORECAST_URL}?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`);
      if(!fcRes.ok) throw new Error('Forecast not available');
      const fc = await fcRes.json();
      renderWeather(cur, fc);
    } catch(err){
      showError('Could not load weather: ' + (err.message || err));
    }
  }

  function renderWeather(cur, fc){
    // current
    cityName.textContent = `${cur.name}, ${cur.sys?.country || ''}`;
    tempEl.textContent = Math.round(cur.main.temp) + '°C';
    descEl.textContent = cur.weather?.[0]?.description || '';
    feelsEl.textContent = 'Feels: ' + Math.round(cur.main.feels_like) + '°C';
    humidityEl.textContent = 'Humidity: ' + cur.main.humidity + '%';
    windEl.textContent = 'Wind: ' + (cur.wind?.speed ?? '--') + ' m/s';
    const icon = cur.weather?.[0]?.icon;
    if(icon) wicon.src = ICON_URL(icon);
    else wicon.src = '';

    setBackgroundByWeather(cur.weather?.[0]?.main);

    // forecast
    forecastEl.innerHTML = '';
    if(fc && fc.list){
      const days = buildDailyForecast(fc.list);
      days.forEach(item=>{
        const d = new Date(item.dt*1000);
        const weekday = d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});
        const ic = item.weather?.[0]?.icon;
        const html = `
          <div class="day card">
            <div class="dname">${weekday}</div>
            <div style="font-weight:700">${Math.round(item.main.temp)}°C</div>
            <div style="text-transform:capitalize">${item.weather?.[0]?.description || ''}</div>
            <img src="${ic ? ICON_URL(ic) : ''}" alt="" width="64" height="64" style="margin-top:6px"/>
          </div>`;
        forecastEl.insertAdjacentHTML('beforeend', html);
      });
    }
  }

  // ====== events ======
  searchBtn.addEventListener('click', ()=> {
    const q = qInput.value.trim();
    if(!q) { showError('Type a city name to search'); return; }
    fetchWeatherByCity(q);
  });
  qInput.addEventListener('keypress', (e)=> { if(e.key === 'Enter') searchBtn.click(); });

  locBtn.addEventListener('click', ()=>{
    if(!navigator.geolocation){ showError('Geolocation not supported'); return;}
    navigator.geolocation.getCurrentPosition(pos=>{
      fetchWeatherByCoords(pos.coords.latitude, pos.coords.longitude);
    }, err=>{
      showError('Could not get location: ' + err.message);
    });
  });

  // load a default city to show something
  (function init(){
    const defaultCity = 'Nairobi';
    qInput.value = defaultCity;
    fetchWeatherByCity(defaultCity);
  })();

  </script>
</body>
</html>
